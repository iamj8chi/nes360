<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>No Est√°n Solos VR - Zet Studios</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="dist\aframe-extras.min.js"></script>
    <script src="dist\aframe-teleport-controls.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="cloudModel" src="assets\nube.glb"></a-asset-item>

        <a-asset-item id="samuuModel" src="assets\samuu.glb"></a-asset-item>

        <a-asset-item
          id="flamingoModel"
          src="assets\flamengo.glb"
        ></a-asset-item>

        <a-asset-item id="groundModel" src="assets\ground.glb"></a-asset-item>
      </a-assets>

      <!-- Fade overlay -->
      <a-entity
        id="fadeOverlay"
        geometry="primitive: plane; height: 100; width: 100"
        material="color: black; opacity: 0.0; shader: flat"
        position="0 1.6 -1"
        visible="true"
      ></a-entity>

      <!-- Red clouds to switch to specific scenes -->
      <a-entity
        id="redCloud1"
        class="cloud clickable red-cloud"
        geometry="primitive: sphere; radius: 0.8"
        material="color: red"
        position="-2 4 -10"
      >
        <a-text
          value="Click me"
          align="center"
          position="0 1 0"
          visible="false"
        ></a-text>
      </a-entity>
      <a-entity
        id="redCloud2"
        class="cloud clickable red-cloud"
        geometry="primitive: sphere; radius: 0.8"
        material="color: red"
        position="0 4 -10"
      >
        <a-text
          value="Click me"
          align="center"
          position="0 1 0"
          visible="false"
        ></a-text>
      </a-entity>
      <a-entity
        id="redCloud3"
        class="cloud clickable red-cloud"
        geometry="primitive: sphere; radius: 0.8"
        material="color: red"
        position="2 4 -10"
      >
        <a-text
          value="Click me"
          align="center"
          position="0 1 0"
          visible="false"
        ></a-text>
      </a-entity>

      <!-- Camera Rig -->

      <a-entity id="cameraRig" position="0 1.6 0">
        <a-camera
          cursor="rayOrigin: mouse"
          raycaster="objects: .clickable"
        ></a-camera>

        <!-- Left Hand -->

        <a-entity
          laser-controls="hand: left"
          teleport-controls="cameraRig: #cameraRig; collisionEntities: .clickable"
          raycaster="objects: .clickable"
          cursor="fuse: false; rayOrigin: entity"
          id="leftHand"
        >
          <a-entity
            id="leftWing"
            geometry="primitive: box; height: 0.5; width: 0.15; depth: 1"
            material="color: pink"
            position="0 -0.3 0.1"
          ></a-entity>
        </a-entity>

        <!-- Right Hand -->

        <a-entity
          laser-controls="hand: right"
          teleport-controls="cameraRig: #cameraRig; collisionEntities: .clickable"
          raycaster="objects: .clickable"
          cursor="fuse: false; rayOrigin: entity"
          id="rightHand"
        >
          <a-entity
            id="rightWing"
            geometry="primitive: box; height: 0.5; width: 0.15; depth: 1"
            material="color: pink"
            position="0 -0.3 0.1"
          ></a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <!-- Scene Templates -->

    <!-- Scene #1 - Intro-->>

    <template id="scene1">
      <a-entity>
        <a-sky color="lightblue"></a-sky>

        <!-- Ocean -->
        <a-ocean
          width="50"
          depth="50"
          density="40"
          opacity="1"
          position="0 0 0"
        ></a-ocean>

        <!-- White Clouds -->

        <a-entity
          class="cloud clickable"
          gltf-model="#cloudModel"
          position="-10 2 -15"
          scale="1 1 1"
          rotation="0 180 0"
        >
          <a-text
            value="Click me"
            align="center"
            position="0 1 0"
            visible="false"
          ></a-text>
        </a-entity>

        <a-entity
          class="cloud clickable"
          gltf-model="#cloudModel"
          position="4 4 -18"
          scale="1 1 1"
          rotation="0 45 0"
        >
          <a-text
            value="Click me"
            align="center"
            position="0 1 0"
            visible="false"
          ></a-text>
        </a-entity>

        <a-entity
          class="cloud clickable"
          gltf-model="#cloudModel"
          position="8 3 -22"
          scale="1 1 1"
          rotation="0 90 0"
        >
          <a-text
            value="Click me"
            align="center"
            position="0 1 0"
            visible="false"
          ></a-text>
        </a-entity>

        <!-- Flamingos -->
        <a-entity
          gltf-model="#flamingoModel"
          position="-15 3 -10"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 500; easing: easeInOutSine; loop: true; to: -15 2.5 -10"
          animation-mixer="clip: fly-loop; timeScale: 1.5"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="-10 3 -13"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 1000; easing: easeInOutSine; loop: true; to: -10 2.5 -13"
          animation-mixer="clip: fly-loop; timeScale: 1.4"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="-5 3 -16"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 2000; easing: easeInOutSine; loop: true; to: -5 2.5 -16"
          animation-mixer="clip: fly-loop; timeScale: 1.5"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="0 3 -20"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 0; easing: easeInOutSine; loop: true; to: 0 2.5 -20"
          animation-mixer="clip: fly-loop; timeScale: 1.8"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="5 3 -16"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 200; easing: easeInOutSine; loop: true; to: 5 2.5 -16"
          animation-mixer="clip: fly-loop; timeScale: 1.4"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="10 3 -13"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 300; easing: easeInOutSine; loop: true; to: 10 2.5 -13"
          animation-mixer="clip: fly-loop; timeScale: 1.5"
        >
        </a-entity>

        <a-entity
          gltf-model="#flamingoModel"
          position="15 3 -10"
          scale="3 3 3"
          animation="property: position; dir: alternate; dur: 2000; delay: 800; easing: easeInOutSine; loop: true; to: 15 2.5 -10"
          animation-mixer="clip: fly-loop; timeScale: 1.7"
        >
        </a-entity>

        <!-- Animated Ground -->
        <a-entity
          gltf-model="#groundModel"
          position="150 -100 0"
          scale="100 100 100"
          rotation="0 0 0"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 60000; easing: linear"
        >
        </a-entity>
      </a-entity>
    </template>

    <template id="scene2">
      <a-entity>
        <a-sky color="lightblue"></a-sky>

        <a-entity
          class="cloud clickable red-cloud"
          geometry="primitive: sphere; radius: 0.8"
          material="color: red"
          position="0 2 -10"
        >
          <a-text
            value="Click me"
            align="center"
            position="0 1 0"
            visible="false"
          ></a-text>
        </a-entity>

        <!-- Animated Ground -->
        <a-entity
          class="dynamic"
          geometry="primitive: plane; width: 50; height: 50"
          material="color: green"
          position="0 -50 0"
          rotation="-90 0 0"
          animation="property: rotation; to: -90 360 0; loop: true; dur: 30000; easing: linear"
        ></a-entity>
      </a-entity>
    </template>

    <template id="scene3">
      <a-entity>
        <a-sky color="#87ceeb"></a-sky>

        <a-entity
          geometry="primitive: box"
          material="color: blue"
          position="-3 2 -8"
          animation="property: position; dir: alternate; dur: 2000; easing: easeInOutSine; loop: true; to: -3 2.5 -8"
        ></a-entity>
        <a-entity
          class="cloud clickable red-cloud"
          geometry="primitive: sphere; radius: 0.8"
          material="color: red"
          position="2 3 -10"
        >
          <a-text
            value="Click me"
            align="center"
            position="0 1 0"
            visible="false"
          ></a-text>
        </a-entity>

        <!-- Animated Ground -->
        <a-entity
          class="dynamic"
          geometry="primitive: plane; width: 50; height: 50"
          material="color: green"
          position="0 -50 0"
          rotation="-90 0 0"
          animation="property: rotation; to: -90 360 0; loop: true; dur: 30000; easing: linear"
        >
        </a-entity>
      </a-entity>

      <!-- Arboles -->

      <a-entity
        gltf-model="#samuuModel"
        position="3 2 -8"
        scale="1 1 1"
        rotation="0 0 0"
      >
      </a-entity>
    </template>

    <!-- Reinsert the script to handle scene switching and cloud enhancement -->
    <script>
      let currentSceneIndex = 1;

      function fadeInOverlay() {
        const overlay = document.querySelector("#fadeOverlay");
        overlay.setAttribute(
          "animation",
          "property: material.opacity; from: 0; to: 1; dur: 500"
        );
        return new Promise((res) => setTimeout(res, 500));
      }

      function fadeOutOverlay() {
        const overlay = document.querySelector("#fadeOverlay");
        overlay.setAttribute(
          "animation",
          "property: material.opacity; from: 1; to: 0; dur: 500"
        );
        return new Promise((res) => setTimeout(res, 500));
      }

      function detachCloudHandlers() {
        document.querySelectorAll(".cloud").forEach((cloud) => {
          const clone = cloud.cloneNode(true);
          cloud.parentNode.replaceChild(clone, cloud);
        });
      }

      async function loadScene(index) {
        await fadeInOverlay();
        currentSceneIndex = index;
        const scene = document.querySelector("a-scene");
        detachCloudHandlers();
        const oldSceneEntities = scene.querySelectorAll(".dynamic");
        oldSceneEntities.forEach((el) => el.remove());
        const template = document.querySelector(`#scene${index}`);
        const clone = template.content.cloneNode(true);
        clone
          .querySelectorAll("*")
          .forEach((el) => el.classList.add("dynamic"));
        scene.appendChild(clone);
        attachCloudHandlers();
        await fadeOutOverlay();
      }

      function showClickText(entity) {
        const text = entity.querySelector("a-text");
        if (text) text.setAttribute("visible", "true");
      }

      function hideClickText(entity) {
        const text = entity.querySelector("a-text");
        if (text) text.setAttribute("visible", "false");
      }

      function enhanceCloud(cloud) {
        cloud.addEventListener("mouseenter", () => {
          const isRed = cloud.classList.contains("red-cloud");
          cloud.setAttribute("material", "color", isRed ? "darkred" : "gray");
          showClickText(cloud);
        });
        cloud.addEventListener("mouseleave", () => {
          const isRed = cloud.classList.contains("red-cloud");
          cloud.setAttribute("material", "color", isRed ? "red" : "white");
          hideClickText(cloud);
        });

        cloud.addEventListener("click", () => {
          if (cloud.id === "redCloud1") loadScene(1);
          else if (cloud.id === "redCloud2") loadScene(2);
          else if (cloud.id === "redCloud3") loadScene(3);
          else {
            const pos = cloud.getAttribute("position");
            document
              .querySelector("#cameraRig")
              .setAttribute(
                "position",
                `${pos.x} ${parseFloat(pos.y) + 1.6} ${pos.z}`
              );
          }
        });
      }

      function attachCloudHandlers() {
        document.querySelectorAll(".cloud").forEach(enhanceCloud);
      }

      window.addEventListener("load", () => {
        attachCloudHandlers();
        loadScene(1);
      });
    </script>
  </body>
</html>
