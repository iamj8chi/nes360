<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>No Estan Solos 360Â° VR | Zet Studios</title>

    <!-- A-Frame Core -->
    <script src="dist/aframe.min.js"></script>
    <script src="dist/aframe-extras.min.js"></script>

    <!-- NES360 Components -->
    <script src="src/loader.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      .error-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        z-index: 9999;
        display: none;
        justify-content: center;
        align-items: center;
        font-family: monospace;
        padding: 20px;
        box-sizing: border-box;
      }

      .error-content {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 8px;
        max-width: 600px;
        white-space: pre-wrap;
      }

      .error-close {
        background: #ff4444;
        border: none;
        color: white;
        padding: 10px 20px;
        margin-top: 20px;
        cursor: pointer;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <!-- Error Overlay -->
    <div id="errorOverlay" class="error-overlay">
      <div class="error-content">
        <h3>Error</h3>
        <div id="errorText"></div>
        <button id="errorClose" class="error-close">Close</button>
      </div>
    </div>

    <a-scene
      id="mainScene"
      embedded
      style="height: 100vh; width: 100vw"
      vr-mode-ui="enabled: true"
      inspector="url: https://cdn.jsdelivr.net/gh/aframevr/aframe-inspector@master/dist/aframe-inspector.min.js"
      loading-screen="dotsColor: red; backgroundColor: black"
    >
      <!-- Game Manager -->
      <a-entity id="gameManager"></a-entity>

      <!-- Assets -->
      <a-assets>
        <!-- Models -->
        <a-asset-item
          id="scenarioModel"
          src="assets/scenario.glb"
        ></a-asset-item>
        <a-asset-item
          id="jaguareteModel"
          src="assets/jaguarete.glb"
        ></a-asset-item>
        <a-asset-item id="nanduModel" src="assets/nandu.glb"></a-asset-item>
        <a-asset-item
          id="flamengoModel"
          src="assets/flamengo.glb"
        ></a-asset-item>
        <a-asset-item id="jurumiModel" src="assets/jurumi.glb"></a-asset-item>
        <a-asset-item id="taguaModel" src="assets/tagua.glb"></a-asset-item>
        <a-asset-item id="tatuModel" src="assets/tatu.glb"></a-asset-item>

        <!-- UI Assets -->
        <img id="trackerBg" src="assets/ui/tracker-background.png" />

        <!-- Billboard Assets -->
        <img id="cartelMain" src="assets/img/cartel-main.png" />
        <img id="cartelSafari" src="assets/img/cartel-safari.png" />
        <img id="cartelVuelo" src="assets/img/cartel-vuelo.png" />
      </a-assets>

      <!-- Environment -->
      <a-sky color="#87ceeb"></a-sky>

      <!-- Lighting -->
      <a-entity
        light="type: hemisphere; color: #ffffff; groundColor: #556655; intensity: 0.8"
      ></a-entity>
      <a-entity
        light="type: directional; color: #ffffff; intensity: 1.3; castShadow: true"
        position="0 50 0"
      ></a-entity>

      <!-- Ocean -->
      <a-ocean
        width="500"
        depth="500"
        density="20"
        opacity="0.9"
        position="30 -0.5 -10"
      ></a-ocean>

      <!-- Ground -->
      <a-entity
        geometry="primitive: circle; radius: 50; segments: 32"
        material="color: #96d165"
        shadow="receive: true"
        rotation="-90 0 0"
        position="0 0.01 0"
      >
      </a-entity>

      <!-- Boundary Ring -->
      <a-entity
        id="boundaryRing"
        geometry="primitive: cylinder; radius: 45; height: 10; openEnded: true"
        material="color: #0066ff; transparent: true; opacity: 0.2; side: double"
        position="0 5 0"
      >
      </a-entity>

      <!-- Scenario Model -->
      <a-entity
        id="scenario"
        gltf-model="#scenarioModel"
        position="0 0 0"
      ></a-entity>

      <!-- Information Cartels -->
      <a-entity id="carteles" position="0 0 -6">
        <!-- Main Information Cartel -->
        <a-entity
          id="cartelMain"
          billboard-cartel="texture: #cartelMain; legs: 2; width: 4; height: 3; interactive: false"
          position="0 0 0"
        ></a-entity>

        <!-- Safari Game Cartel (Interactive) -->
        <a-entity
          id="cartelSafari"
          class="clickable billboard"
          billboard-cartel="texture: #cartelSafari; legs: 1; width: 2.5; height: 2; interactive: true; action: safari"
          position="-3.5 0 0.5"
        ></a-entity>

        <!-- Flight Game Cartel (Coming Soon) -->
        <a-entity
          id="cartelVuelo"
          class="clickable billboard"
          billboard-cartel="texture: #cartelVuelo; legs: 1; width: 2.5; height: 2; interactive: true; action: vuelo"
          position="3.5 0 0.5"
        ></a-entity>
      </a-entity>

      <!-- Safari Animals -->
      <a-entity id="animals">
        <a-entity
          id="flamengo"
          class="clickable animal"
          data-animal-type="flamingo"
          gltf-model="#flamengoModel"
          position="-5.14962 0 -31.29516"
          rotation="0 195.6 0"
          scale="2 2 2"
          animation-mixer="clip: idle"
          animal-controller
          animal-behavior
        >
        </a-entity>

        <a-entity
          id="jaguarete"
          class="clickable animal"
          data-animal-type="jaguarete"
          gltf-model="#jaguareteModel"
          position="-8.52793 0 16.69473"
          rotation="0 -45 0"
          scale="2 2 2"
          animation-mixer
          animal-controller
          animal-behavior
        >
        </a-entity>

        <a-entity
          id="nandu"
          class="clickable animal"
          data-animal-type="nandu"
          gltf-model="#nanduModel"
          position="22.16629 0 -1.51447"
          rotation="0 163 0"
          scale="2 2 2"
          animation-mixer
          animal-controller
          animal-behavior
        >
        </a-entity>

        <a-entity
          id="jurumi"
          class="clickable animal"
          data-animal-type="jurumi"
          gltf-model="#jurumiModel"
          position="-20.43949 0 -2.0148"
          rotation="0 208.28 0"
          scale="2 2 2"
          animation-mixer
          animal-controller
          animal-behavior
        >
        </a-entity>

        <a-entity
          id="tagua"
          class="clickable animal"
          data-animal-type="tagua"
          gltf-model="#taguaModel"
          position="10.42833 0 16.71228"
          rotation="0 160.4 0"
          scale="2 2 2"
          animation-mixer
          animal-controller
          animal-behavior
        >
        </a-entity>

        <a-entity
          id="tatu"
          class="clickable animal"
          data-animal-type="tatu"
          gltf-model="#tatuModel"
          position="9.99464 0 3.83831"
          rotation="0 149.7 0"
          scale="2 2 2"
          animation-mixer
          animal-controller
          animal-behavior
        >
        </a-entity>
      </a-entity>

      <!-- Player Camera Rig -->
      <a-entity id="cameraRig" position="0 0 0">
        <!-- Camera -->
        <a-entity
          id="head"
          camera
          look-controls="pointerLockEnabled: false"
          position="0 1.6 0"
        ></a-entity>

        <!-- VR Controllers -->
        <a-entity
          id="leftHand"
          hand-controls="hand: left; handModelStyle: lowPoly; color: #ffccaa"
          progress-ui
        ></a-entity>
        <a-entity
          id="rightHand"
          hand-controls="hand: right; handModelStyle: lowPoly; color: #ffccaa"
          laser-controls="hand: right"
          raycaster="objects: .clickable, .animal, .billboard; far: 20"
          line="color: #FF0000; opacity: 0.75"
          animal-highlighter
        >
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // Initialize error handling
      window.addEventListener("error", (ev) => {
        const overlay = document.getElementById("errorOverlay");
        const text = document.getElementById("errorText");
        if (text)
          text.textContent =
            ev.message + "\n" + (ev.filename || "") + ":" + (ev.lineno || "");
        if (overlay) overlay.style.display = "flex";
      });

      document.getElementById("errorClose")?.addEventListener("click", () => {
        document.getElementById("errorOverlay").style.display = "none";
      });

      // Load components when A-Frame is ready
      document.addEventListener("DOMContentLoaded", () => {
        if (window.AFRAME) {
          window.NES360_ComponentLoader.loadAll();
        } else {
          console.error("A-Frame not loaded");
        }
      });
    </script>
  </body>
</html>
